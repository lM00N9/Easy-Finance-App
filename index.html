<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyFinance - Financial Management System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .auth-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 400px;
            margin: 100px auto;
            text-align: center;
        }
        
        .app-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none;
        }
        
        .nav-bar {
            background: #2c3e50;
            padding: 15px 20px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .nav-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            padding: 10px 20px;
            background: #34495e;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .nav-tab.active {
            background: #3498db;
        }
        
        .nav-tab:hover {
            background: #4a6741;
        }
        
        .content {
            padding: 30px;
            min-height: 600px;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .kpi-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .alert {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .btn {
            background: #3498db;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #27ae60;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        
        .chart-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            min-height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .chart-canvas {
            max-width: 500px;
            height: auto;
            margin-top: 20px;
        }
        
        .instructions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            line-height: 1.6;
        }
        
        .config-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .category-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }
        
        .category-tag {
            background: #3498db;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .income { color: #27ae60; }
        .expense { color: #e74c3c; }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            padding-top: 50px;
            overflow: auto;
        }
        
        .modal-content {
            background-color: white;
            margin: 0 auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            position: relative;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: black;
        }

        .date-range-container {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .user-name-edit {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            width: 120px;
        }

        .access-denied {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .nav-bar {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .nav-tabs {
                justify-content: center;
            }
            
            .nav-tab {
                padding: 8px 15px;
                font-size: 14px;
            }
            
            .content {
                padding: 15px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            div[style*="grid-template-columns: 1fr 1fr"] {
                display: block !important;
            }
            
            div[style*="grid-template-columns: 1fr 1fr"] > div {
                margin-bottom: 20px;
            }

            .date-range-container {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="authScreen" class="auth-container">
            <h2 data-lang="es">üîê EasyFinance</h2>
            <h2 data-lang="en" class="hidden">üîê EasyFinance</h2>
            <p style="margin: 20px 0; color: #666;" data-lang="es">Sistema de Gesti√≥n Financiera Personal</p>
            <p style="margin: 20px 0; color: #666;" data-lang="en" class="hidden">Personal Financial Management System</p>
            <div class="form-group">
                <input type="password" id="licenseKey" placeholder="C√≥digo de acceso / Access code" style="text-align: center; font-weight: bold;">
            </div>
            <select id="languageSelectorAuth" style="width: 100%; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                <option value="es">Espa√±ol</option>
                <option value="en">English</option>
            </select>
            <button class="btn" id="loginBtn">Acceder al Sistema</button>
        </div>

        <div id="mainApp" class="app-container">
            <div class="nav-bar">
                <h2 data-lang="es">üí∞ EasyFinance</h2>
                <h2 data-lang="en" class="hidden">üí∞ EasyFinance</h2>
                <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 10px; color: white;">
                        <span data-lang="es">üë§ Usuario:</span>
                        <span data-lang="en" class="hidden">üë§ User:</span>
                        <input type="text" id="user1Name" class="user-name-edit" value="Usuario 1">
                        <span style="color: white;">/</span>
                        <input type="text" id="user2Name" class="user-name-edit" value="Usuario 2">
                        <select id="userSelector" style="padding: 5px; border-radius: 3px; margin-left: 10px;">
                            <option value="user1">Usuario 1</option>
                            <option value="user2">Usuario 2</option>
                        </select>
                        <select id="languageSelector" style="padding: 5px; border-radius: 3px; background: #34495e; color: white; border: none;">
                            <option value="es">Espa√±ol</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                    <div class="nav-tabs">
                        <button class="nav-tab active" data-tab="dashboard" data-lang="es">Dashboard</button>
                        <button class="nav-tab active hidden" data-tab="dashboard" data-lang="en">Dashboard</button>
                        <button class="nav-tab" data-tab="transactions" data-lang="es">Transacciones</button>
                        <button class="nav-tab hidden" data-tab="transactions" data-lang="en">Transactions</button>
                        <button class="nav-tab" data-tab="reports" data-lang="es">Informes</button>
                        <button class="nav-tab hidden" data-tab="reports" data-lang="en">Reports</button>
                        <button class="nav-tab" data-tab="config" data-lang="es">Configuraci√≥n</button>
                        <button class="nav-tab hidden" data-tab="config" data-lang="en">Settings</button>
                        <button class="nav-tab" data-tab="instructions" data-lang="es">Manual</button>
                        <button class="nav-tab hidden" data-tab="instructions" data-lang="en">Manual</button>
                    </div>
                </div>
            </div>

            <div class="content">
                <div id="dashboard" class="tab-content">
                    <h2 data-lang="es">üìä Dashboard - <span id="currentUserDisplay">Usuario 1</span></h2>
                    <h2 data-lang="en" class="hidden">üìä Dashboard - <span id="currentUserDisplayEn">User 1</span></h2>
                    
                    <div class="alert" id="budgetAlert">
                        <span data-lang="es">‚ö†Ô∏è Sobrepresupuesto - Los gastos del mes superan el presupuesto establecido</span>
                        <span data-lang="en" class="hidden">‚ö†Ô∏è Overbudget - Monthly expenses exceed the set budget</span>
                    </div>

                    <div class="dashboard-grid">
                        <div class="kpi-card">
                            <h3 data-lang="es">üí∞ Ingresos del Mes</h3>
                            <h3 data-lang="en" class="hidden">üí∞ Monthly Income</h3>
                            <div class="kpi-value income" id="monthlyIncome">$0</div>
                        </div>
                        <div class="kpi-card">
                            <h3 data-lang="es">üí∏ Gastos del Mes</h3>
                            <h3 data-lang="en" class="hidden">üí∏ Monthly Expenses</h3>
                            <div class="kpi-value expense" id="monthlyExpenses">$0</div>
                        </div>
                        <div class="kpi-card">
                            <h3 data-lang="es">üíµ Balance</h3>
                            <h3 data-lang="en" class="hidden">üíµ Balance</h3>
                            <div class="kpi-value" id="balance">$0</div>
                        </div>
                        <div class="kpi-card">
                            <h3 data-lang="es">üéØ Presupuesto</h3>
                            <h3 data-lang="en" class="hidden">üéØ Budget</h3>
                            <div class="kpi-value" id="budget">$3,000</div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h3 data-lang="es">üìà Distribuci√≥n de Gastos</h3>
                        <h3 data-lang="en" class="hidden">üìà Expense Distribution</h3>
                        <canvas id="categoryChart" class="chart-canvas"></canvas>
                        <p id="noChartData" style="display: none; text-align: center; color: #666; padding: 40px;"></p>
                    </div>
                </div>

                <div id="transactions" class="tab-content hidden">
                    <h2 data-lang="es">üí≥ Registro de Transacciones - <span id="transactionsUserDisplay">Usuario 1</span></h2>
                    <h2 data-lang="en" class="hidden">üí≥ Transaction Log - <span id="transactionsUserDisplayEn">User 1</span></h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <div>
                            <h3 data-lang="es">‚ûï Nueva Transacci√≥n</h3>
                            <h3 data-lang="en" class="hidden">‚ûï New Transaction</h3>
                            <div class="form-group">
                                <label data-lang="es">Tipo:</label>
                                <label data-lang="en" class="hidden">Type:</label>
                                <select id="transactionType">
                                    <option value="income" data-lang="es">Ingreso</option>
                                    <option value="income" data-lang="en" class="hidden">Income</option>
                                    <option value="expense" data-lang="es">Gasto</option>
                                    <option value="expense" data-lang="en" class="hidden">Expense</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label data-lang="es">Categor√≠a:</label>
                                <label data-lang="en" class="hidden">Category:</label>
                                <select id="category">
                                    <option value="Salario" data-lang="es">Salario</option>
                                    <option value="Salary" data-lang="en" class="hidden">Salary</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label data-lang="es">Monto:</label>
                                <label data-lang="en" class="hidden">Amount:</label>
                                <input type="number" id="amount" step="0.01" placeholder="0.00" min="0">
                            </div>
                            <div class="form-group">
                                <label data-lang="es">Descripci√≥n:</label>
                                <label data-lang="en" class="hidden">Description:</label>
                                <input type="text" id="description" placeholder="Descripci√≥n de la transacci√≥n / Transaction description" maxlength="100">
                            </div>
                            <div class="form-group">
                                <label data-lang="es">Fecha:</label>
                                <label data-lang="en" class="hidden">Date:</label>
                                <input type="date" id="transactionDate">
                            </div>
                            <button class="btn btn-success" id="addTransactionBtn" data-lang="es">Agregar Transacci√≥n</button>
                            <button class="btn btn-success hidden" id="addTransactionBtnEn" data-lang="en">Add Transaction</button>
                        </div>
                        
                        <div>
                            <h3 data-lang="es">üìã Transacciones Recientes</h3>
                            <h3 data-lang="en" class="hidden">üìã Recent Transactions</h3>
                            <div id="transactionsList" style="max-height: 400px; overflow-y: auto;">
                                <p style="text-align: center; color: #666; padding: 40px;" data-lang="es">No hay transacciones registradas</p>
                                <p style="text-align: center; color: #666; padding: 40px;" data-lang="en" class="hidden">No transactions registered</p>
                            </div>
                            <button class="btn" id="manageTransactionsBtn" style="margin-top: 15px;" data-lang="es">üõ†Ô∏è Administrar Transacciones</button>
                            <button class="btn hidden" id="manageTransactionsBtnEn" style="margin-top: 15px;" data-lang="en">üõ†Ô∏è Manage Transactions</button>
                        </div>
                    </div>
                </div>

                <div id="reports" class="tab-content hidden">
                    <h2 data-lang="es">üìà Informes y An√°lisis - <span id="reportsUserDisplay">Usuario 1</span></h2>
                    <h2 data-lang="en" class="hidden">üìà Reports & Analysis - <span id="reportsUserDisplayEn">User 1</span></h2>
                    
                    <div class="config-section">
                        <h3 data-lang="es">üìÖ Seleccionar Per√≠odo del Informe</h3>
                        <h3 data-lang="en" class="hidden">üìÖ Select Report Period</h3>
                        <div class="date-range-container">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label data-lang="es">Fecha de inicio:</label>
                                <label data-lang="en" class="hidden">Start Date:</label>
                                <input type="date" id="startDate">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label data-lang="es">Fecha de fin:</label>
                                <label data-lang="en" class="hidden">End Date:</label>
                                <input type="date" id="endDate">
                            </div>
                            <div>
                                <button class="btn" id="generateReportBtn" data-lang="es">Generar Informe</button>
                                <button class="btn hidden" id="generateReportBtnEn" data-lang="en">Generate Report</button>
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <button class="btn" onclick="setQuickPeriod('today')" style="margin-right: 10px; background: #95a5a6;" data-lang="es">Hoy</button>
                            <button class="btn hidden" onclick="setQuickPeriod('today')" style="margin-right: 10px; background: #95a5a6;" data-lang="en">Today</button>
                            <button class="btn" onclick="setQuickPeriod('week')" style="margin-right: 10px; background: #95a5a6;" data-lang="es">Esta Semana</button>
                            <button class="btn hidden" onclick="setQuickPeriod('week')" style="margin-right: 10px; background: #95a5a6;" data-lang="en">This Week</button>
                            <button class="btn" onclick="setQuickPeriod('month')" style="margin-right: 10px; background: #95a5a6;" data-lang="es">Este Mes</button>
                            <button class="btn hidden" onclick="setQuickPeriod('month')" style="margin-right: 10px; background: #95a5a6;" data-lang="en">This Month</button>
                            <button class="btn" onclick="setQuickPeriod('year')" style="background: #95a5a6;" data-lang="es">Este A√±o</button>
                            <button class="btn hidden" onclick="setQuickPeriod('year')" style="background: #95a5a6;" data-lang="en">This Year</button>
                        </div>
                    </div>

                    <div id="reportContent">
                        <p data-lang="es">Seleccione las fechas de inicio y fin, luego genere el informe para ver los datos del per√≠odo elegido</p>
                        <p data-lang="en" class="hidden">Select start and end dates, then generate the report to see data for the chosen period</p>
                    </div>
                    
                    <button class="btn" onclick="window.print()" style="margin-top: 20px;" data-lang="es">üñ®Ô∏è Imprimir Informe</button>
                    <button class="btn hidden" onclick="window.print()" style="margin-top: 20px;" data-lang="en">üñ®Ô∏è Print Report</button>
                </div>

                <div id="config" class="tab-content hidden">
                    <h2 data-lang="es">‚öôÔ∏è Configuraci√≥n - <span id="configUserDisplay">Usuario 1</span></h2>
                    <h2 data-lang="en" class="hidden">‚öôÔ∏è Settings - <span id="configUserDisplayEn">User 1</span></h2>
                    
                    <div class="config-section">
                        <h3 data-lang="es">üë• Nombres de Usuario</h3>
                        <h3 data-lang="en" class="hidden">üë• User Names</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label data-lang="es">Nombre Usuario 1:</label>
                                <label data-lang="en" class="hidden">User 1 Name:</label>
                                <input type="text" id="configUser1Name" value="Usuario 1">
                                <button class="btn" onclick="updateUserName('user1')" style="margin-top: 10px;" data-lang="es">Actualizar Nombre</button>
                                <button class="btn hidden" onclick="updateUserName('user1')" style="margin-top: 10px;" data-lang="en">Update Name</button>
                            </div>
                            <div class="form-group">
                                <label data-lang="es">Nombre Usuario 2:</label>
                                <label data-lang="en" class="hidden">User 2 Name:</label>
                                <input type="text" id="configUser2Name" value="Usuario 2">
                                <button class="btn" onclick="updateUserName('user2')" style="margin-top: 10px;" data-lang="es">Actualizar Nombre</button>
                                <button class="btn hidden" onclick="updateUserName('user2')" style="margin-top: 10px;" data-lang="en">Update Name</button>
                            </div>
                        </div>
                    </div>

                    <div class="config-section">
                        <h3 data-lang="es">üéØ Presupuesto Mensual</h3>
                        <h3 data-lang="en" class="hidden">üéØ Monthly Budget</h3>
                        <div class="form-group">
                            <label data-lang="es">Presupuesto:</label>
                            <label data-lang="en" class="hidden">Budget:</label>
                            <input type="number" id="monthlyBudget" value="3000" step="100" min="0">
                        </div>
                        <button class="btn" id="updateBudgetBtn" data-lang="es">Actualizar Presupuesto</button>
                        <button class="btn hidden" id="updateBudgetBtnEn" data-lang="en">Update Budget</button>
                    </div>

                    <div class="config-section">
                        <h3 data-lang="es">üè∑Ô∏è Categor√≠as Personalizadas</h3>
                        <h3 data-lang="en" class="hidden">üè∑Ô∏è Custom Categories</h3>
                        <p data-lang="es">Categor√≠as actuales:</p>
                        <p data-lang="en" class="hidden">Current categories:</p>
                        <div class="category-list" id="categoryListDisplay">
                            </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                            <div>
                                <label data-lang="es">Agregar nueva categor√≠a:</label>
                                <label data-lang="en" class="hidden">Add new category:</label>
                                <input type="text" id="newCategory" placeholder="Nombre de la categor√≠a / Category name" maxlength="30">
                                <div class="form-group">
                                    <label data-lang="es">Tipo:</label>
                                    <label data-lang="en" class="hidden">Type:</label>
                                    <select id="newCategoryType">
                                        <option value="income" data-lang="es">Ingreso</option>
                                        <option value="income" data-lang="en" class="hidden">Income</option>
                                        <option value="expense" data-lang="es">Gasto</option>
                                        <option value="expense" data-lang="en" class="hidden">Expense</option>
                                    </select>
                                </div>
                                <button class="btn" id="addCategoryBtn" data-lang="es">‚ûï Agregar</button>
                                <button class="btn hidden" id="addCategoryBtnEn" data-lang="en">‚ûï Add</button>
                            </div>
                            <div>
                                <label data-lang="es">Eliminar categor√≠a:</label>
                                <label data-lang="en" class="hidden">Delete category:</label>
                                <select id="categoryToDelete">
                                    <option value="" data-lang="es">Seleccionar categor√≠a...</option>
                                    <option value="" data-lang="en" class="hidden">Select category...</option>
                                </select>
                                <button class="btn btn-danger" id="deleteCategoryBtn" style="margin-top: 10px;" data-lang="es">üóëÔ∏è Eliminar</button>
                                <button class="btn btn-danger hidden" id="deleteCategoryBtnEn" style="margin-top: 10px;" data-lang="en">üóëÔ∏è Delete</button>
                            </div>
                        </div>
                    </div>

                    <div class="config-section">
                        <h3 data-lang="es">üíæ Copia de Seguridad</h3>
                        <h3 data-lang="en" class="hidden">üíæ Backup</h3>
                        <p data-lang="es">Guarda tus datos para tener una copia de seguridad o cargarlos en otro dispositivo.</p>
                        <p data-lang="en" class="hidden">Save your data to have a backup or load it on another device.</p>
                        <button class="btn" id="exportBtn" data-lang="es">Descargar Datos</button>
                        <button class="btn hidden" id="exportBtnEn" data-lang="en">Download Data</button>
                        <input type="file" id="importFile" style="display:none;">
                        <button class="btn" id="importBtn" data-lang="es">Cargar Datos</button>
                        <button class="btn hidden" id="importBtnEn" data-lang="en">Upload Data</button>
                    </div>
                </div>

                <div id="instructions" class="tab-content hidden">
                    <h2 data-lang="es">üìñ Manual de Instrucciones</h2>
                    <h2 data-lang="en" class="hidden">üìñ Instruction Manual</h2>
                    
                    <div class="instructions">
                        <h3 data-lang="es">üöÄ C√≥mo usar EasyFinance</h3>
                        <h3 data-lang="en" class="hidden">üöÄ How to use EasyFinance</h3>
                        
                        <h4 data-lang="es">1. Dashboard</h4>
                        <h4 data-lang="en" class="hidden">1. Dashboard</h4>
                        <p data-lang="es">El dashboard muestra un resumen de tu situaci√≥n financiera actual con ingresos, gastos, balance y alertas de presupuesto para el mes en curso.</p>
                        <p data-lang="en" class="hidden">The dashboard shows a summary of your current financial situation with income, expenses, balance, and budget alerts for the current month.</p>

                        <h4 data-lang="es">2. Registro de Transacciones</h4>
                        <h4 data-lang="en" class="hidden">2. Transaction Log</h4>
                        <p data-lang="es">Ve a la pesta√±a "Transacciones", selecciona el tipo (Ingreso o Gasto), elige una categor√≠a, ingresa el monto y descripci√≥n, selecciona la fecha y haz clic en "Agregar Transacci√≥n".</p>
                        <p data-lang="en" class="hidden">Go to the "Transactions" tab, select the type (Income or Expense), choose a category, enter the amount and description, select the date, and click "Add Transaction".</p>

                        <h4 data-lang="es">3. M√∫ltiples Usuarios</h4>
                        <h4 data-lang="en" class="hidden">3. Multiple Users</h4>
                        <p data-lang="es">El sistema permite 2 usuarios con datos completamente independientes. Puedes personalizar los nombres de los usuarios desde la configuraci√≥n y cambiar entre ellos desde la barra superior.</p>
                        <p data-lang="en" class="hidden">The system allows for 2 users with completely independent data. You can customize user names from the settings and switch between them from the top bar.</p>

                        <h4 data-lang="es">4. Informes Personalizables</h4>
                        <h4 data-lang="en" class="hidden">4. Customizable Reports</h4>
                        <p data-lang="es">Genera informes de cualquier per√≠odo seleccionando fechas de inicio y fin. Usa los botones r√°pidos para per√≠odos comunes (hoy, semana, mes, a√±o) o define tu propio rango personalizado.</p>
                        <p data-lang="en" class="hidden">Generate reports for any period by selecting start and end dates. Use the quick buttons for common periods (today, week, month, year) or define your own custom range.</p>

                        <h4 data-lang="es">5. Configuraci√≥n</h4>
                        <h4 data-lang="en" class="hidden">5. Settings</h4>
                        <p data-lang="es">Personaliza los nombres de usuario, ajusta tu presupuesto mensual y gestiona categor√≠as personalizadas desde la secci√≥n de configuraci√≥n.</p>
                        <p data-lang="en" class="hidden">Customize user names, adjust your monthly budget, and manage custom categories from the settings section.</p>

                        <h4 data-lang="es">6. Seguridad del Sistema</h4>
                        <h4 data-lang="en" class="hidden">6. System Security</h4>
                        <p data-lang="es">EasyFinance est√° protegido con c√≥digo de acceso.</p>
                        <p data-lang="en" class="hidden">EasyFinance is protected with an access code.</p>
                        
                        <h3 data-lang="es" style="color: #e74c3c;">‚ö†Ô∏è Avisos Importantes</h3>
                        <h3 data-lang="en" class="hidden" style="color: #e74c3c;">‚ö†Ô∏è Important Notices</h3>
                        <ul data-lang="es">
                            <li><strong>Almacenamiento Local:</strong> Toda la informaci√≥n que ingresas se guarda directamente en tu dispositivo. EasyFinance no tiene acceso a tus datos personales ni los almacena en ning√∫n servidor.</li>
                            <li><strong>Responsabilidad:</strong> El sistema no se hace responsable por la p√©rdida de datos. La opci√≥n de "Descargar Datos" en la secci√≥n de Configuraci√≥n es crucial para que puedas guardar una copia de seguridad y evitar perder tu informaci√≥n si cambias de dispositivo o borras la memoria cach√© de tu navegador.</li>
                            <li><strong>Conexi√≥n a Internet:</strong> Solo se requiere internet la primera vez que ingresas para validar el c√≥digo de acceso. Una vez dentro, puedes usar la aplicaci√≥n sin conexi√≥n.</li>
                            <li><strong>Tipo de Licencia:</strong> La compra del c√≥digo es de un solo pago. No hay cuotas adicionales.</li>
                        </ul>
                        <ul data-lang="en" class="hidden">
                            <li><strong>Local Storage:</strong> All the information you enter is saved directly on your device. EasyFinance does not have access to your personal data or store it on any server.</li>
                            <li><strong>Responsibility:</strong> The system is not responsible for data loss. The "Download Data" option in the Settings section is crucial for you to save a backup copy and avoid losing your information if you switch devices or clear your browser's cache.</li>
                            <li><strong>Internet Connection:</strong> Internet is only required the first time you log in to validate the access code. Once inside, you can use the application offline.</li>
                            <li><strong>License Type:</strong> The code purchase is a one-time payment. There are no additional fees.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="transactionModal" class="modal">
            <div class="modal-content">
                <span class="close" id="closeModal">&times;</span>
                <h3 data-lang="es">üõ†Ô∏è Administrar Transacciones</h3>
                <h3 data-lang="en" class="hidden">üõ†Ô∏è Manage Transactions</h3>
                <div id="allTransactionsList">
                    <p style="text-align: center; padding: 40px;" data-lang="es">No hay transacciones para administrar</p>
                    <p style="text-align: center; padding: 40px;" data-lang="en" class="hidden">No transactions to manage</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const authScreen = document.getElementById('authScreen');
            const mainApp = document.getElementById('mainApp');
            const loginBtn = document.getElementById('loginBtn');
            const licenseKeyInput = document.getElementById('licenseKey');
            const languageSelectorAuth = document.getElementById('languageSelectorAuth');
            const languageSelectorApp = document.getElementById('languageSelector');
            const navTabs = document.querySelectorAll('.nav-tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const userSelector = document.getElementById('userSelector');
            const user1NameInput = document.getElementById('user1Name');
            const user2NameInput = document.getElementById('user2Name');
            const configUser1NameInput = document.getElementById('configUser1Name');
            const configUser2NameInput = document.getElementById('configUser2Name');
            const currentUserDisplay = document.getElementById('currentUserDisplay');
            const currentUserDisplayEn = document.getElementById('currentUserDisplayEn');
            const transactionsUserDisplay = document.getElementById('transactionsUserDisplay');
            const transactionsUserDisplayEn = document.getElementById('transactionsUserDisplayEn');
            const reportsUserDisplay = document.getElementById('reportsUserDisplay');
            const reportsUserDisplayEn = document.getElementById('reportsUserDisplayEn');
            const configUserDisplay = document.getElementById('configUserDisplay');
            const configUserDisplayEn = document.getElementById('configUserDisplayEn');

            const monthlyIncomeEl = document.getElementById('monthlyIncome');
            const monthlyExpensesEl = document.getElementById('monthlyExpenses');
            const balanceEl = document.getElementById('balance');
            const budgetEl = document.getElementById('budget');
            const budgetAlertEl = document.getElementById('budgetAlert');
            const transactionTypeEl = document.getElementById('transactionType');
            const categoryEl = document.getElementById('category');
            const amountEl = document.getElementById('amount');
            const descriptionEl = document.getElementById('description');
            const transactionDateEl = document.getElementById('transactionDate');
            const addTransactionBtn = document.getElementById('addTransactionBtn');
            const transactionsListEl = document.getElementById('transactionsList');
            const manageTransactionsBtn = document.getElementById('manageTransactionsBtn');
            const transactionModal = document.getElementById('transactionModal');
            const closeModalBtn = document.getElementById('closeModal');
            const allTransactionsListEl = document.getElementById('allTransactionsList');
            const categoryListDisplayEl = document.getElementById('categoryListDisplay');
            const newCategoryInput = document.getElementById('newCategory');
            const newCategoryTypeEl = document.getElementById('newCategoryType');
            const addCategoryBtn = document.getElementById('addCategoryBtn');
            const categoryToDeleteEl = document.getElementById('categoryToDelete');
            const deleteCategoryBtn = document.getElementById('deleteCategoryBtn');
            const monthlyBudgetInput = document.getElementById('monthlyBudget');
            const updateBudgetBtn = document.getElementById('updateBudgetBtn');
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            const generateReportBtn = document.getElementById('generateReportBtn');
            const reportContentEl = document.getElementById('reportContent');

            // NUEVOS elementos para importar/exportar
            const exportBtn = document.getElementById('exportBtn');
            const importBtn = document.getElementById('importBtn');
            const importFile = document.getElementById('importFile');

            let chart;
            const locales = {
                es: {
                    titles: {
                        dashboard: "Dashboard",
                        transactions: "Transacciones",
                        reports: "Informes",
                        config: "Configuraci√≥n",
                        manual: "Manual"
                    },
                    auth: {
                        title: "üîê EasyFinance",
                        subtitle: "Sistema de Gesti√≥n Financiera Personal",
                        placeholder: "C√≥digo de acceso / Access code",
                        button: "Acceder al Sistema"
                    },
                    dashboard: {
                        user: "Usuario",
                        monthlyIncome: "üí∞ Ingresos del Mes",
                        monthlyExpenses: "üí∏ Gastos del Mes",
                        balance: "üíµ Balance",
                        budget: "üéØ Presupuesto",
                        overbudgetAlert: "‚ö†Ô∏è Sobrepresupuesto - Los gastos del mes superan el presupuesto establecido",
                        expenseDistribution: "üìà Distribuci√≥n de Gastos",
                        noChartData: "No hay suficientes datos de gastos para mostrar un gr√°fico. Registre algunas transacciones."
                    },
                    transactions: {
                        title: "üí≥ Registro de Transacciones",
                        newUser: "Nuevo Usuario",
                        newTransaction: "‚ûï Nueva Transacci√≥n",
                        type: "Tipo:",
                        income: "Ingreso",
                        expense: "Gasto",
                        category: "Categor√≠a:",
                        amount: "Monto:",
                        description: "Descripci√≥n:",
                        date: "Fecha:",
                        addBtn: "Agregar Transacci√≥n",
                        recent: "üìã Transacciones Recientes",
                        noTransactions: "No hay transacciones registradas",
                        manageBtn: "üõ†Ô∏è Administrar Transacciones",
                        manageModalTitle: "üõ†Ô∏è Administrar Transacciones",
                        noTransactionsManage: "No hay transacciones para administrar"
                    },
                    reports: {
                        title: "üìà Informes y An√°lisis",
                        selectPeriod: "üìÖ Seleccionar Per√≠odo del Informe",
                        startDate: "Fecha de inicio:",
                        endDate: "Fecha de fin:",
                        generateBtn: "Generar Informe",
                        today: "Hoy",
                        thisWeek: "Esta Semana",
                        thisMonth: "Este Mes",
                        thisYear: "Este A√±o",
                        instructions: "Seleccione las fechas de inicio y fin, luego genere el informe para ver los datos del per√≠odo elegido"
                    },
                    settings: {
                        title: "‚öôÔ∏è Configuraci√≥n",
                        userNames: "üë• Nombres de Usuario",
                        user1Name: "Nombre Usuario 1:",
                        user2Name: "Nombre Usuario 2:",
                        updateBtn: "Actualizar Nombre",
                        monthlyBudget: "üéØ Presupuesto Mensual",
                        budget: "Presupuesto:",
                        updateBudgetBtn: "Actualizar Presupuesto",
                        customCategories: "üè∑Ô∏è Categor√≠as Personalizadas",
                        currentCategories: "Categor√≠as actuales:",
                        addCategory: "Agregar nueva categor√≠a:",
                        addBtn: "‚ûï Agregar",
                        deleteCategory: "Eliminar categor√≠a:",
                        selectCategory: "Seleccionar categor√≠a...",
                        deleteBtn: "üóëÔ∏èÔ∏è Eliminar"
                    },
                    manual: {
                        title: "üìñ Manual de Instrucciones",
                        howTo: "üöÄ C√≥mo usar EasyFinance",
                        dashboardSection: "1. Dashboard",
                        dashboardText: "El dashboard muestra un resumen de tu situaci√≥n financiera actual con ingresos, gastos, balance y alertas de presupuesto para el mes en curso.",
                        transactionsSection: "2. Registro de Transacciones",
                        transactionsText: "Ve a la pesta√±a \"Transacciones\", selecciona el tipo (Ingreso o Gasto), elige una categor√≠a, ingresa el monto y descripci√≥n, selecciona la fecha y haz clic en \"Agregar Transacci√≥n\".",
                        multiUserSection: "3. M√∫ltiples Usuarios",
                        multiUserText: "El sistema permite 2 usuarios con datos completamente independientes. Puedes personalizar los nombres de los usuarios desde la configuraci√≥n y cambiar entre ellos desde la barra superior.",
                        reportsSection: "4. Informes Personalizables",
                        reportsText: "Genera informes de cualquier per√≠odo seleccionando fechas de inicio y fin. Usa los botones r√°pidos para per√≠odos comunes (hoy, semana, mes, a√±o) o define tu propio rango personalizado.",
                        settingsSection: "5. Configuraci√≥n",
                        settingsText: "Personaliza los nombres de usuario, ajusta tu presupuesto mensual y gestiona categor√≠as personalizadas desde la secci√≥n de configuraci√≥n.",
                        securitySection: "6. Seguridad del Sistema",
                        securityText: "EasyFinance est√° protegido con c√≥digo de acceso."
                    }
                },
                en: {
                    titles: {
                        dashboard: "Dashboard",
                        transactions: "Transactions",
                        reports: "Reports",
                        config: "Settings",
                        manual: "Manual"
                    },
                    auth: {
                        title: "üîê EasyFinance",
                        subtitle: "Personal Financial Management System",
                        placeholder: "C√≥digo de acceso / Access code",
                        button: "Access System"
                    },
                    dashboard: {
                        user: "User",
                        monthlyIncome: "üí∞ Monthly Income",
                        monthlyExpenses: "üí∏ Monthly Expenses",
                        balance: "üíµ Balance",
                        budget: "üéØ Budget",
                        overbudgetAlert: "‚ö†Ô∏è Overbudget - Monthly expenses exceed the set budget",
                        expenseDistribution: "üìà Expense Distribution",
                        noChartData: "Not enough expense data to show a chart. Register some transactions."
                    },
                    transactions: {
                        title: "üí≥ Transaction Log",
                        newUser: "New User",
                        newTransaction: "‚ûï New Transaction",
                        type: "Type:",
                        income: "Income",
                        expense: "Expense",
                        category: "Category:",
                        amount: "Amount:",
                        description: "Description:",
                        date: "Date:",
                        addBtn: "Add Transaction",
                        recent: "üìã Recent Transactions",
                        noTransactions: "No transactions registered",
                        manageBtn: "üõ†Ô∏è Manage Transactions",
                        manageModalTitle: "üõ†Ô∏è Manage Transactions",
                        noTransactionsManage: "No transactions to manage"
                    },
                    reports: {
                        title: "üìà Reports & Analysis",
                        selectPeriod: "üìÖ Select Report Period",
                        startDate: "Start Date:",
                        endDate: "End Date:",
                        generateBtn: "Generate Report",
                        today: "Today",
                        thisWeek: "This Week",
                        thisMonth: "This Month",
                        thisYear: "This Year",
                        instructions: "Select start and end dates, then generate the report to see data for the chosen period"
                    },
                    settings: {
                        title: "‚öôÔ∏è Settings",
                        userNames: "üë• User Names",
                        user1Name: "User 1 Name:",
                        user2Name: "User 2 Name:",
                        updateBtn: "Update Name",
                        monthlyBudget: "üéØ Monthly Budget",
                        budget: "Budget:",
                        updateBudgetBtn: "Update Budget",
                        customCategories: "üè∑Ô∏è Custom Categories",
                        currentCategories: "Current categories:",
                        addCategory: "Add new category:",
                        addBtn: "‚ûï Add",
                        deleteCategory: "Delete category:",
                        selectCategory: "Select category...",
                        deleteBtn: "üóëÔ∏èÔ∏è Delete"
                    },
                    manual: {
                        title: "üìñ Instruction Manual",
                        howTo: "üöÄ How to use EasyFinance",
                        dashboardSection: "1. Dashboard",
                        dashboardText: "The dashboard shows a summary of your current financial situation with income, expenses, balance, and budget alerts for the current month.",
                        transactionsSection: "2. Transaction Log",
                        transactionsText: "Go to the \"Transactions\" tab, select the type (Income or Expense), choose a category, enter the amount and description, select the date, and click \"Add Transaction\".",
                        multiUserSection: "3. Multiple Users",
                        multiUserText: "The system allows for 2 users with completely independent data. You can customize user names from the settings and switch between them from the top bar.",
                        reportsSection: "4. Customizable Reports",
                        reportsText: "Generate reports for any period by selecting start and end dates. Use the quick buttons for common periods (today, week, month, year) or define your own custom range.",
                        settingsSection: "5. Configuraci√≥n",
                        settingsText: "Customize user names, adjust your monthly budget, and manage custom categories from the settings section.",
                        securitySection: "6. System Security",
                        securityText: "EasyFinance is protected with an access code."
                    }
                }
            };

            let currentLang = localStorage.getItem('appLang') || 'es';
            let currentUser = localStorage.getItem('currentUser') || 'user1';
            let users = JSON.parse(localStorage.getItem('easyFinanceUsers')) || {
                user1: {
                    name: "Usuario 1",
                    transactions: [],
                    budget: 3000,
                    categories: {
                        income: [{
                            es: "Salario",
                            en: "Salary"
                        }, {
                            es: "Regalo",
                            en: "Gift"
                        }, {
                            es: "Inversi√≥n",
                            en: "Investment"
                        }],
                        expense: [{
                            es: "Alquiler",
                            en: "Rent"
                        }, {
                            es: "Comida",
                            en: "Food"
                        }, {
                            es: "Transporte",
                            en: "Transport"
                        }]
                    }
                },
                user2: {
                    name: "Usuario 2",
                    transactions: [],
                    budget: 3000,
                    categories: {
                        income: [{
                            es: "Salario",
                            en: "Salary"
                        }, {
                            es: "Ventas",
                            en: "Sales"
                        }],
                        expense: [{
                            es: "Alquiler",
                            en: "Rent"
                        }, {
                            es: "Servicios",
                            en: "Utilities"
                        }, {
                            es: "Entretenimiento",
                            en: "Entertainment"
                        }]
                    }
                }
            };

            function saveState() {
                localStorage.setItem('easyFinanceUsers', JSON.stringify(users));
                localStorage.setItem('currentUser', currentUser);
                localStorage.setItem('appLang', currentLang);
            }

            function loadAndRender() {
                loadCurrentUserInfo();
                updateDashboard();
                updateTransactionsList();
                updateCategorySelects();
                updateUserNamesInNav();
                updateBudgetInConfig();
            }

            function updateLang() {
                const elements = document.querySelectorAll('[data-lang]');
                elements.forEach(el => {
                    if (el.dataset.lang === currentLang) {
                        el.classList.remove('hidden');
                    } else {
                        el.classList.add('hidden');
                    }
                });
            }

            function loadCurrentUserInfo() {
                if (currentUser === 'user1') {
                    userSelector.value = 'user1';
                    currentUserDisplay.textContent = users.user1.name;
                    currentUserDisplayEn.textContent = users.user1.name;
                    transactionsUserDisplay.textContent = users.user1.name;
                    transactionsUserDisplayEn.textContent = users.user1.name;
                    reportsUserDisplay.textContent = users.user1.name;
                    reportsUserDisplayEn.textContent = users.user1.name;
                    configUserDisplay.textContent = users.user1.name;
                    configUserDisplayEn.textContent = users.user1.name;
                } else {
                    userSelector.value = 'user2';
                    currentUserDisplay.textContent = users.user2.name;
                    currentUserDisplayEn.textContent = users.user2.name;
                    transactionsUserDisplay.textContent = users.user2.name;
                    transactionsUserDisplayEn.textContent = users.user2.name;
                    reportsUserDisplay.textContent = users.user2.name;
                    reportsUserDisplayEn.textContent = users.user2.name;
                    configUserDisplay.textContent = users.user2.name;
                    configUserDisplayEn.textContent = users.user2.name;
                }
                user1NameInput.value = users.user1.name;
                user2NameInput.value = users.user2.name;
                configUser1NameInput.value = users.user1.name;
                configUser2NameInput.value = users.user2.name;
            }

            function updateDashboard() {
                const user = users[currentUser];
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();

                const monthlyTransactions = user.transactions.filter(t => {
                    const transactionDate = new Date(t.date);
                    return transactionDate.getMonth() === currentMonth && transactionDate.getFullYear() === currentYear;
                });

                const monthlyIncome = monthlyTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                const monthlyExpenses = monthlyTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                const balance = monthlyIncome - monthlyExpenses;

                monthlyIncomeEl.textContent = `$${monthlyIncome.toFixed(2)}`;
                monthlyExpensesEl.textContent = `$${monthlyExpenses.toFixed(2)}`;
                balanceEl.textContent = `$${balance.toFixed(2)}`;
                balanceEl.style.color = balance >= 0 ? '#27ae60' : '#e74c3c';

                budgetEl.textContent = `$${user.budget.toFixed(2)}`;
                if (monthlyExpenses > user.budget) {
                    budgetAlertEl.style.display = 'block';
                } else {
                    budgetAlertEl.style.display = 'none';
                }

                updateExpenseChart(monthlyTransactions);
            }

            function updateExpenseChart(transactions) {
                const expenseTransactions = transactions.filter(t => t.type === 'expense');
                const categoryTotals = {};

                expenseTransactions.forEach(t => {
                    if (categoryTotals[t.category]) {
                        categoryTotals[t.category] += t.amount;
                    } else {
                        categoryTotals[t.category] = t.amount;
                    }
                });

                const labels = Object.keys(categoryTotals);
                const data = Object.values(categoryTotals);
                const ctx = document.getElementById('categoryChart').getContext('2d');
                const noDataEl = document.getElementById('noChartData');
                
                if (data.length === 0) {
                    if (chart) {
                        chart.destroy();
                    }
                    noDataEl.style.display = 'block';
                    noDataEl.textContent = locales[currentLang].dashboard.noChartData;
                    return;
                } else {
                    noDataEl.style.display = 'none';
                }

                if (chart) {
                    chart.destroy();
                }

                chart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: [
                                '#3498db', '#e74c3c', '#2ecc71', '#f1c40f', '#9b59b6', '#34495e', '#1abc9c', '#95a5a6', '#d35400', '#c0392b'
                            ],
                            borderColor: 'white',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed || 0;
                                        return `${label}: $${value.toFixed(2)}`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            function updateTransactionsList() {
                const user = users[currentUser];
                const list = user.transactions.slice().sort((a, b) => new Date(b.date) - new Date(a.date));
                const recentList = list.slice(0, 10);
                
                transactionsListEl.innerHTML = '';
                if (recentList.length === 0) {
                    const p = document.createElement('p');
                    p.style.cssText = 'text-align: center; color: #666; padding: 40px;';
                    p.textContent = locales[currentLang].transactions.noTransactions;
                    transactionsListEl.appendChild(p);
                } else {
                    recentList.forEach(t => {
                        const transactionItem = document.createElement('div');
                        transactionItem.style.cssText = 'border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 5px; background: #f9f9f9;';
                        transactionItem.innerHTML = `
                            <strong>${t.category}</strong><br>
                            <span style="color: ${t.type === 'income' ? '#27ae60' : '#e74c3c'}; font-weight: bold;">
                                ${t.type === 'income' ? '+' : '-'}$${t.amount.toFixed(2)}
                            </span>
                            <br>${t.description} (${t.date})
                        `;
                        transactionsListEl.appendChild(transactionItem);
                    });
                }
            }

            function updateAllTransactionsList() {
                const user = users[currentUser];
                const list = user.transactions.slice().sort((a, b) => new Date(b.date) - new Date(a.date));
                allTransactionsListEl.innerHTML = '';

                if (list.length === 0) {
                    const p = document.createElement('p');
                    p.style.cssText = 'text-align: center; padding: 40px;';
                    p.textContent = locales[currentLang].transactions.noTransactionsManage;
                    allTransactionsListEl.appendChild(p);
                } else {
                    list.forEach((t, index) => {
                        const transactionItem = document.createElement('div');
                        transactionItem.style.cssText = 'display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd; padding: 10px 0;';
                        const info = `
                            <strong>${t.category}</strong><br>
                            <span style="color: ${t.type === 'income' ? '#27ae60' : '#e74c3c'}; font-weight: bold;">
                                ${t.type === 'income' ? '+' : '-'}$${t.amount.toFixed(2)}
                            </span>
                            <br>${t.description} (${t.date})
                        `;
                        transactionItem.innerHTML = `
                            <div>${info}</div>
                            <button class="btn btn-danger" data-index="${index}" data-lang="es">Eliminar</button>
                            <button class="btn btn-danger hidden" data-index="${index}" data-lang="en">Delete</button>
                        `;
                        allTransactionsListEl.appendChild(transactionItem);
                    });

                    document.querySelectorAll('#allTransactionsList .btn-danger').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const index = e.target.dataset.index;
                            if (confirm('¬øEst√°s seguro de que quieres eliminar esta transacci√≥n?')) {
                                users[currentUser].transactions.splice(index, 1);
                                saveState();
                                loadAndRender();
                            }
                        });
                    });
                }
            }

            function updateCategorySelects() {
                const user = users[currentUser];
                const incomeCats = user.categories.income;
                const expenseCats = user.categories.expense;

                categoryEl.innerHTML = '';
                categoryToDeleteEl.innerHTML = `<option value="" data-lang="es">Seleccionar categor√≠a...</option><option value="" data-lang="en" class="hidden">Select category...</option>`;

                const transactionType = transactionTypeEl.value;
                const relevantCats = transactionType === 'income' ? incomeCats : expenseCats;
                relevantCats.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat[currentLang];
                    option.textContent = cat[currentLang];
                    categoryEl.appendChild(option);
                });

                [...incomeCats, ...expenseCats].forEach(cat => {
                    const option = document.createElement('option');
                    option.value = JSON.stringify(cat);
                    option.textContent = cat[currentLang];
                    categoryToDeleteEl.appendChild(option);
                });

                // Update category list in config section
                categoryListDisplayEl.innerHTML = '';
                [...incomeCats, ...expenseCats].forEach(cat => {
                    const span = document.createElement('span');
                    span.className = 'category-tag';
                    span.textContent = cat[currentLang];
                    categoryListDisplayEl.appendChild(span);
                });

                updateLang();
            }

            function updateUserNamesInNav() {
                userSelector.querySelector(`option[value='user1']`).textContent = users.user1.name;
                userSelector.querySelector(`option[value='user2']`).textContent = users.user2.name;
                document.getElementById('user1Name').value = users.user1.name;
                document.getElementById('user2Name').value = users.user2.name;
            }

            function updateBudgetInConfig() {
                monthlyBudgetInput.value = users[currentUser].budget;
            }

            function updateAllDisplayNames() {
                updateUserNamesInNav();
                loadCurrentUserInfo();
            }

            async function handleLogin() {
                const licenseKey = licenseKeyInput.value;
                try {
                    const response = await fetch('./codes.txt');
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    const data = await response.text();
                    const validCodes = data.split('\n').map(code => code.trim());
                    if (validCodes.includes(licenseKey)) {
                        authScreen.style.display = 'none';
                        mainApp.style.display = 'block';
                        loadAndRender();
                        updateLang();
                    } else {
                        alert("Acceso Denegado. C√≥digo incorrecto.");
                    }
                } catch (error) {
                    console.error('Error de conexi√≥n:', error);
                    alert("Error de conexi√≥n. Por favor, intenta de nuevo.");
                }
            }

            loginBtn.addEventListener('click', handleLogin);
            licenseKeyInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });

            navTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    navTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    tabContents.forEach(content => content.classList.add('hidden'));
                    document.getElementById(tab.dataset.tab).classList.remove('hidden');
                });
            });

            userSelector.addEventListener('change', (e) => {
                currentUser = e.target.value;
                saveState();
                loadAndRender();
            });

            addTransactionBtn.addEventListener('click', () => {
                const type = transactionTypeEl.value;
                const category = categoryEl.value;
                const amount = parseFloat(amountEl.value);
                const description = descriptionEl.value;
                const date = transactionDateEl.value;

                if (amount <= 0 || !category || !date) {
                    alert("Por favor, rellena todos los campos correctamente.");
                    return;
                }

                const newTransaction = {
                    type,
                    category,
                    amount,
                    description,
                    date
                };

                users[currentUser].transactions.push(newTransaction);
                saveState();
                loadAndRender();

                amountEl.value = '';
                descriptionEl.value = '';
                transactionDateEl.value = '';
            });

            transactionTypeEl.addEventListener('change', updateCategorySelects);

            manageTransactionsBtn.addEventListener('click', () => {
                transactionModal.style.display = 'block';
                updateAllTransactionsList();
            });

            closeModalBtn.addEventListener('click', () => {
                transactionModal.style.display = 'none';
            });

            window.addEventListener('click', (e) => {
                if (e.target === transactionModal) {
                    transactionModal.style.display = 'none';
                }
            });

            addCategoryBtn.addEventListener('click', () => {
                const newCategoryName = newCategoryInput.value.trim();
                const newCategoryType = newCategoryTypeEl.value;

                if (!newCategoryName) {
                    alert("El nombre de la categor√≠a no puede estar vac√≠o.");
                    return;
                }

                const user = users[currentUser];
                const existingCategory = user.categories[newCategoryType].find(c => c.es.toLowerCase() === newCategoryName.toLowerCase() || c.en.toLowerCase() === newCategoryName.toLowerCase());

                if (existingCategory) {
                    alert("Esa categor√≠a ya existe.");
                    return;
                }

                user.categories[newCategoryType].push({
                    es: newCategoryName,
                    en: newCategoryName
                });
                saveState();
                updateCategorySelects();
                newCategoryInput.value = '';
            });

            deleteCategoryBtn.addEventListener('click', () => {
                const categoryInfo = categoryToDeleteEl.value;

                if (!categoryInfo) {
                    alert("Por favor, selecciona una categor√≠a para eliminar.");
                    return;
                }

                const categoryToDeleteInfo = JSON.parse(categoryInfo);
                const user = users[currentUser];
                let deleted = false;

                ['income', 'expense'].forEach(type => {
                    const index = user.categories[type].findIndex(cat => cat.es === categoryToDeleteInfo.es);
                    if (index !== -1) {
                        user.categories[type].splice(index, 1);
                        deleted = true;
                    }
                });

                if (deleted) {
                    saveState();
                    updateCategorySelects();
                    alert("Categor√≠a eliminada.");
                }
            });

            updateBudgetBtn.addEventListener('click', () => {
                const newBudget = parseFloat(monthlyBudgetInput.value);
                if (newBudget >= 0) {
                    users[currentUser].budget = newBudget;
                    saveState();
                    updateDashboard();
                    alert("Presupuesto actualizado.");
                } else {
                    alert("El presupuesto debe ser un n√∫mero positivo.");
                }
            });

            function updateUserName(userKey) {
                const nameInput = document.getElementById(`config${userKey === 'user1' ? 'User1' : 'User2'}Name`);
                const newName = nameInput.value.trim();
                if (newName) {
                    users[userKey].name = newName;
                    saveState();
                    updateAllDisplayNames();
                    alert("Nombre de usuario actualizado.");
                }
            }

            function generateReport() {
                const user = users[currentUser];
                const startDate = new Date(startDateInput.value);
                const endDate = new Date(endDateInput.value);

                if (!startDate || !endDate || startDate > endDate) {
                    reportContentEl.innerHTML = `<p style="color: #e74c3c;">Fechas no v√°lidas. Por favor, selecciona un rango de fechas correcto.</p>`;
                    return;
                }

                const filteredTransactions = user.transactions.filter(t => {
                    const transactionDate = new Date(t.date);
                    return transactionDate >= startDate && transactionDate <= endDate;
                });

                let totalIncome = 0;
                let totalExpenses = 0;
                const expenseBreakdown = {};

                filteredTransactions.forEach(t => {
                    if (t.type === 'income') {
                        totalIncome += t.amount;
                    } else {
                        totalExpenses += t.amount;
                        if (expenseBreakdown[t.category]) {
                            expenseBreakdown[t.category] += t.amount;
                        } else {
                            expenseBreakdown[t.category] = t.amount;
                        }
                    }
                });

                const balance = totalIncome - totalExpenses;

                let reportHtml = `
                    <h3 data-lang="es">Resumen del Per√≠odo</h3>
                    <p data-lang="es"><strong>Ingresos Totales:</strong> $${totalIncome.toFixed(2)}</p>
                    <p data-lang="es"><strong>Gastos Totales:</strong> $${totalExpenses.toFixed(2)}</p>
                    <p data-lang="es"><strong>Balance:</strong> $${balance.toFixed(2)}</p>
                    
                    <h4 data-lang="es">Desglose de Gastos por Categor√≠a</h4>
                `;

                for (const category in expenseBreakdown) {
                    const percentage = (expenseBreakdown[category] / totalExpenses) * 100;
                    reportHtml += `<p>${category}: $${expenseBreakdown[category].toFixed(2)} (${percentage.toFixed(2)}%)</p>`;
                }
                
                reportContentEl.innerHTML = reportHtml;
                updateLang();
            }
            
            generateReportBtn.addEventListener('click', generateReport);
            
            function setQuickPeriod(period) {
                const now = new Date();
                let start = new Date();
                let end = now;

                if (period === 'today') {
                    start.setHours(0, 0, 0, 0);
                    end.setHours(23, 59, 59, 999);
                } else if (period === 'week') {
                    const day = now.getDay();
                    start = new Date(now.getFullYear(), now.getMonth(), now.getDate() - day);
                    end = new Date(start);
                    end.setDate(start.getDate() + 6);
                } else if (period === 'month') {
                    start = new Date(now.getFullYear(), now.getMonth(), 1);
                    end = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                } else if (period === 'year') {
                    start = new Date(now.getFullYear(), 0, 1);
                    end = new Date(now.getFullYear(), 11, 31);
                }

                startDateInput.value = start.toISOString().split('T')[0];
                endDateInput.value = end.toISOString().split('T')[0];
                generateReport();
            }

            languageSelectorAuth.addEventListener('change', (e) => {
                currentLang = e.target.value;
                updateLang();
            });

            languageSelectorApp.addEventListener('change', (e) => {
                currentLang = e.target.value;
                updateLang();
                updateCategorySelects();
                updateTransactionsList();
                updateAllTransactionsList();
            });

            // NUEVO: Funcionalidad para exportar datos
            exportBtn.addEventListener('click', () => {
                const data = localStorage.getItem('easyFinanceUsers');
                if (data) {
                    const blob = new Blob([data], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `easyfinance_backup_${new Date().toISOString().slice(0, 10)}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    alert("Datos descargados exitosamente.");
                } else {
                    alert("No hay datos para descargar.");
                }
            });

            // NUEVO: Funcionalidad para importar datos
            importBtn.addEventListener('click', () => {
                importFile.click();
            });

            importFile.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            if (importedData && importedData.user1 && importedData.user2) {
                                localStorage.setItem('easyFinanceUsers', e.target.result);
                                alert("Datos cargados exitosamente. La p√°gina se recargar√° para aplicar los cambios.");
                                window.location.reload();
                            } else {
                                alert("El archivo no tiene el formato de datos correcto.");
                            }
                        } catch (error) {
                            alert("Error al leer el archivo. Aseg√∫rate de que es un archivo de datos v√°lido.");
                        }
                    };
                    reader.readAsText(file);
                }
            });

            loadAndRender();
            updateLang();
        });
    </script>
</body>
</html>
